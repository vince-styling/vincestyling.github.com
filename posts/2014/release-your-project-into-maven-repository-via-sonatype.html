<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width,initial-scale=1.0" name="viewport">
    <meta content="Vince Styling" name="author">
    <meta content="a blog about all things in software engineering by vince styling." name="description">
    <meta content="java, android, mac, git, ruby, ubuntu, css, jquery, perl, j2ee, geek, devops, software engineering, programming" name="keywords">
    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="/css/site.css" media="screen" rel="stylesheet" type="text/css">
    <title>release your project into maven repository via Sonatype — vince styling</title>
</head>
<body>
<div class="topper">
    <div class="container">
        <div class="navigation">
            <h1 class="masthead">Vince<img src="/images/avatar.png"/>Styling</h1>
            <div class="nav-list">
                <a href="/">
                    <i class="fa fa-home fa-2x"></i>
                </a>
                <a href="https://github.com/vince-styling" target="_blank">
                    <i class="fa fa-github fa-2x"></i>
                </a>
                <a href="http://stackoverflow.com/users/1294681/vincestyling" target="_blank">
                    <i class="fa fa-stack-overflow fa-2x"></i>
                </a>
                <a href="http://weibo.com/styling" target="_blank">
                    <i class="fa fa-weibo fa-2x"></i>
                </a>
                <a href="/about.html">
                    <i class="fa fa-envelope-o fa-2x"></i>
                </a>
            </div>
        </div>
    </div>
</div>
<div class="container">
    <div class="main">
        <div id="post-thumb">
    <a class="title">release your project into maven repository via Sonatype</a>
    <p class="meta">
        <i class="fa fa-pencil"></i> Posted on Sun  3 Aug 00:27 2014&emsp;
        <i class="fa fa-edit"></i> Modify on Tue 16 Sep 23:23 2014
    </p>
    <div id="body" class="${variable:additional_css}">
        <p>Maven is the popular place where to hosted our java open source projects so we can share with others more simply. Unlike to <code>RubyGems</code>, publish to Maven Central repository was a bit of difficult and complication for a newbie, even an experienced programmer. Unfortunately i didn&#39;t figure out a complete walking guidance to help, thus i decide to archive myself experience in my blog.</p>

<p>If you did the search for this knowledge ever, you surely aware that the most people knows approach is work with Sonatype, of course i&#39;m follow that way as well.</p>

<h1 id="guidance">Guidance</h1>

<p>To begin, you&#39;ll need to <a href="https://issues.sonatype.org/secure/Signup!default.jspa">register a JIRA account</a>, then configure that account on the maven settings file <code>~/.m2/settings.xml</code>, add below information in right place :</p>
<div class="highlight xml"><table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></td><td><pre><span class="nt">&lt;servers&gt;</span>
    <span class="nt">&lt;server&gt;</span>
        <span class="nt">&lt;id&gt;</span>sonatype-nexus-snapshots<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;username&gt;</span>[Your Username]<span class="nt">&lt;/username&gt;</span>
        <span class="nt">&lt;password&gt;</span>[Your Password]<span class="nt">&lt;/password&gt;</span>
    <span class="nt">&lt;/server&gt;</span>
    <span class="nt">&lt;server&gt;</span>
        <span class="nt">&lt;id&gt;</span>sonatype-nexus-staging<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;username&gt;</span>[Your Username]<span class="nt">&lt;/username&gt;</span>
        <span class="nt">&lt;password&gt;</span>[Your Password]<span class="nt">&lt;/password&gt;</span>
    <span class="nt">&lt;/server&gt;</span>
<span class="nt">&lt;/servers&gt;</span>
</pre>
</td></tr></table></div>
<p>Secondly, <a href="https://issues.sonatype.org/secure/CreateIssue.jspa?issuetype=21&amp;pid=10134">create an Issue of your project</a> and fill up the project&#39;s information you can find. After that, we start to waiting the <code>human review</code>, Sonatype will prepare Maven repositories for us and set the issue status as <strong>Resolved</strong> once it get done. We&#39;ll receive an e-mail notice indicating that the issue is resolved, please do not deploy until you received it. Normally this step would takes less than 2 business days, if you havent receive that e-mail, you can leave a comment on the JIRA issue consider as remind them. The relate role who assign to handle your issue will update it quickly. If they write back as comment info like following, that means you can start to release your project.</p>
<div class="highlight text"><table><tr><td class="linenos"><pre>1
2
3</pre></td><td><pre>Configuration has been prepared, now you can:
...
please comment on this issue when you promoted your first release, thanks
</pre>
</td></tr></table></div>
<h2 id="prepare-the-gpg-key">Prepare the GPG key</h2>

<p>Find your way to install <code>GnuPG</code> then use it to generate a key pair :</p>
<div class="highlight bash"><table><tr><td class="linenos"><pre>1</pre></td><td><pre>~ <span class="nv">$ </span>gpg --gen-key
</pre>
</td></tr></table></div>
<p>If it&#39;s your first time to generate the key, make yourself never forget the passphrase because it would be required in next time you release an artifact, i encounter the passphrase lost problem before, it was too bored for get back this, so don&#39;t make the same mistake i made. If you sadly forgot the passphrase or the key was expired, you should delete the past key then re-generate a new key, don&#39;t use a duplicate key name at all. e.g. if you ever generated a key named <code>vincestyling</code>, then you couldn&#39;t use it again, it would be causing a name conflict in the key server. Although you can release successful, but the name conflict will let you get some fatal error like <code>signature failed</code> when you try to close the Staging Repository in future.</p>

<p>After generated the key pair, we should take the public key and distribute it to the remote server, use <code>gpg -k</code> to grab the key we just had :</p>
<div class="highlight bash"><table><tr><td class="linenos"><pre>1
2
3
4
5
6
7</pre></td><td><pre>~ <span class="nv">$ </span>gpg -k

/Users/vince/.gnupg/pubring.gpg
-------------------------------
pub   2048R/F526C615 2014-08-01 <span class="o">[</span>expires: 2014-08-13<span class="o">]</span>
uid                  lingyunxiao <span class="o">(</span>lingyunxiao<span class="o">)</span> &lt;lingyunxiao@qq.com&gt;
sub   2048R/F32F736E 2014-08-01 <span class="o">[</span>expires: 2014-08-13<span class="o">]</span>
</pre>
</td></tr></table></div>
<p>That output information like above, keep an eye of the <code>F526C615</code> string, it&#39;s your public key which you would distribute to, copy the <code>F526C615</code> place&#39;s string then send the key :</p>
<div class="highlight bash"><table><tr><td class="linenos"><pre>1</pre></td><td><pre>~ <span class="nv">$ </span>gpg --keyserver hkp://pgp.mit.edu --send-keys F526C615
</pre>
</td></tr></table></div>
<p>To be safely, we need to make sure that just only one key we have in our computer. If more, we must remove the rest to prevent the name conflict problem. There are two way to do this action, first you can use command <code>gpg --delete-keys</code>, the other way is install the Graphic Application &quot;GPG keychain Access&quot; to checking this :</p>

<p><img src="/images/release_to_maven_keychain.png" alt="GPG keychain Access" title="GPG keychain Access"/></p>

<p>Eventually, we&#39;ve been prepare all jobs about GPG KEY. As supplement, you can pay attention with this <a href="http://blog.sonatype.com/2010/01/how-to-generate-pgp-signatures-with-maven">post</a> for more details.</p>

<h2 id="configure-your-project-module">Configure your project module</h2>

<p>In the project module you wish to publishing, configure some necessary message included accept sonatype as module&#39;s parent, apply a <code>Snapshot</code> version number, configure the <code>scm</code> information, configure maven release <code>plugin</code> etc.</p>
<div class="highlight xml"><table><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74</pre></td><td><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;project&gt;</span>
    <span class="c">&lt;!-- Important step : make sonatype as your project&#39;s root. --&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.sonatype.oss<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>oss-parent<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;relativePath</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;version&gt;</span>7<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>

    <span class="c">&lt;!-- add the project description. --&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.vincestyling<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>traversaless-viewpager<span class="nt">&lt;/artifactId&gt;</span>
    <span class="c">&lt;!-- here must declare as &quot;-SNAPSHOT&quot; phrase. --&gt;</span>
    <span class="nt">&lt;version&gt;</span>4.0.1_r1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>

    <span class="nt">&lt;url&gt;</span>https://github.com/vince-styling/traversaless-viewpager-android<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;description&gt;</span>Traversal less ViewPager widget for Android<span class="nt">&lt;/description&gt;</span>
    <span class="nt">&lt;inceptionYear&gt;</span>2014<span class="nt">&lt;/inceptionYear&gt;</span>

    <span class="nt">&lt;licenses&gt;</span>
        <span class="nt">&lt;license&gt;</span>
            <span class="nt">&lt;name&gt;</span>Apache License Version 2.0<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;url&gt;</span>http://www.apache.org/licenses/LICENSE-2.0.txt<span class="nt">&lt;/url&gt;</span>
            <span class="nt">&lt;distribution&gt;</span>repo<span class="nt">&lt;/distribution&gt;</span>
        <span class="nt">&lt;/license&gt;</span>
    <span class="nt">&lt;/licenses&gt;</span>

    <span class="c">&lt;!-- Important step : maven will commit a few version and</span>
<span class="c">            tagging the release version, so don&#39;t forget this. --&gt;</span>
    <span class="nt">&lt;scm&gt;</span>
        <span class="nt">&lt;connection&gt;</span>scm:git:git@github.com:vince-styling/traversaless-viewpager-android.git<span class="nt">&lt;/connection&gt;</span>
        <span class="nt">&lt;developerConnection&gt;</span>scm:git:git@github.com:vince-styling/traversaless-viewpager-android.git<span class="nt">&lt;/developerConnection&gt;</span>
        <span class="nt">&lt;url&gt;</span>git@github.com:vince-styling/traversaless-viewpager-android.git<span class="nt">&lt;/url&gt;</span>
        <span class="nt">&lt;tag&gt;</span>HEAD<span class="nt">&lt;/tag&gt;</span>
    <span class="nt">&lt;/scm&gt;</span>

    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>3.0<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;source&gt;</span>1.6<span class="nt">&lt;/source&gt;</span>
                    <span class="nt">&lt;target&gt;</span>1.6<span class="nt">&lt;/target&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>

            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>com.jayway.maven.plugins.android.generation2<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>android-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>3.7.0<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;sdk&gt;</span>
                        <span class="nt">&lt;platform&gt;</span>14<span class="nt">&lt;/platform&gt;</span>
                    <span class="nt">&lt;/sdk&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>

            <span class="c">&lt;!-- Important step : config the maven release plugin. --&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-release-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>2.4.2<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;goals&gt;</span>deploy<span class="nt">&lt;/goals&gt;</span>
                    <span class="nt">&lt;autoVersionSubmodules&gt;</span>true<span class="nt">&lt;/autoVersionSubmodules&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre>
</td></tr></table></div>
<p>Now we are going to release a snapshot version to the <code>Staging Repository</code>, open your Terminal and point to following commands :</p>
<div class="highlight bash"><table><tr><td class="linenos"><pre>1
2
3</pre></td><td><pre>~ <span class="nv">$ </span>mvn release:clean
~ <span class="nv">$ </span>mvn release:prepare
~ <span class="nv">$ </span>mvn release:perform
</pre>
</td></tr></table></div>
<p>In the <code>prepare</code> goal, Maven would ask you the <code>GPG passphrase</code> several times, also tagging your current version, commit two changes, push all modification to the <code>remotes</code> at last. Because Maven did a few VCS operations, thus we should rollback them if we got something wrong with this release process.</p>
<div class="highlight bash"><table><tr><td class="linenos"><pre>1
2
3
4
5</pre></td><td><pre><span class="sb">`</span>10a55a3b5b9b4d473e78ccd0c60af0672d7adecd<span class="sb">`</span> is commit <span class="nb">hash </span>code before release.
~ <span class="nv">$ </span>git reset --hard 10a55a3b5b9b4d473e78ccd0c60af0672d7adecd
~ <span class="nv">$ </span>git tag -d TAG_NAME
~ <span class="nv">$ </span>git push origin :refs/tags/TAG_NAME
~ <span class="nv">$ </span>git push --force
</pre>
</td></tr></table></div>
<p>Then perform the &quot;release a snapshot version&quot; operation again.</p>

<h2 id="release-it-in-the-sonatype">Release it in the Sonatype</h2>

<p>After above release was done successfully, we are ready to do the next job in Sonatype. To release the artifact, open your favorite browser and navigate to <a href="https://oss.sonatype.org/">https://oss.sonatype.org/</a>. You should <code>Log In</code> by the earlier account, then go to the <code>Build Promotion</code> tab&#39;s <code>Staging Repositories</code> which in the left pane, find out the Repository that you just release(normally at the list bottom), click the &quot;Close&quot; button then do the rest.</p>

<p><img src="/images/release_to_maven_release_it.png" alt="Release It" title="Release It"/></p>

<p>Sometime you&#39;ll get the error like &#39;signature failed&#39;, remind you to solve the GPG Key pair conflict problem. If happens, you should drop the artifact, then re-release again. Ensure the &quot;Activity&quot; field says &quot;Last operation completed successfully&quot; before you move on.</p>

<p><img src="/images/release_to_maven_release_it_errors.png" alt="Release It" title="Release It"/></p>

<p>If you didn&#39;t see any error in the bottom &quot;Activity&quot; pane, means the <code>Release</code> button might already be enable, keep Refresh the Repositories if you didn&#39;t get it, now it&#39;s time to do the final step :</p>

<p><img src="/images/release_to_maven_release_it_final.png" alt="Release It" title="Release It"/></p>

<p>Congratulation, you&#39;ve done all job about release, once you get successfully, your artifact will be synchronize to the Maven Central soon enough. The best way to verify whether success or not is search your artifact in <a href="search.maven.org">search.maven.org</a>, but it may take time before your artifact display, typically within 10 minutes even hours, so be patient with it.</p>

<p>Throughout this improvement of my ability process, i referenced many articles, it would be detailedly to mark them in the end. I follow this <a href="http://central.sonatype.org/pages/ossrh-guide.html">guide</a> and <a href="https://docs.sonatype.org/pages/diffpages.action?pageId=6619209&amp;originalId=13598740">docs</a> in Sonatype all the time. Also below is my two release issue to record.</p>

<ul>
<li><a href="https://issues.sonatype.org/browse/OSSRH-9739">OSSRH-9739</a></li>
<li><a href="https://issues.sonatype.org/browse/OSSRH-10903">OSSRH-10903</a></li>
</ul>

    </div>
    <div id="comments">
        <div id="disqus_thread"></div>
    </div>
    <script type="text/javascript">
        // a unique identifier for each page where Disqus is present
        var disqus_identifier = 'cb0ddc9e5ffb5daee2eb';

        // required: replace example with your forum shortname
        var disqus_shortname = 'vincestyling';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <div id="recent-posts">
        <p>Recent posts on <strong>vincestyling.com</strong></p>
        <ol class="post-list">
            
                <li class="item" title="产品思维与丰富文档是实现开源项目价值最大化的利器">
                    <span class="meta">2014-10-11</span>
                    <a href="/posts/2014/maximization-the-value-of-your-open-source-project.html">产品思维与丰富文档是实现开源项目价值最大化的利器</a>
                </li>
            
                <li class="item" title="My IntelliJ IDEA customization">
                    <span class="meta">2014-09-28</span>
                    <a href="/posts/2014/my-intellij-idea-customization.html">My IntelliJ IDEA customization</a>
                </li>
            
                <li class="item" title="我是如何阅读开源项目的源代码的">
                    <span class="meta">2014-09-23</span>
                    <a href="/posts/2014/how-am-i-read-open-source-projects-code.html">我是如何阅读开源项目的源代码的</a>
                </li>
            
                <li class="item" title="release your project into maven repository via Sonatype">
                    <span class="meta">2014-08-03</span>
                    <a href="/posts/2014/release-your-project-into-maven-repository-via-sonatype.html">release your project into maven repository via Sonatype</a>
                </li>
            
                <li class="item" title="easily to know and switch the ellipsize mode of textview in Android">
                    <span class="meta">2013-11-27</span>
                    <a href="/posts/2013/easily-to-know-and-switch-the-ellipsize-mode-of-textview-in-android.html">easily to know and switch the ellipsize mode of textview in Android</a>
                </li>
            
        </ol>
    </div>
</div>
    </div>
    <div class="footer">
        <div class="summary">
            <p>Copyright <i class="fa fa-copyright"></i> 2014 - <i class="fa fa-code"></i> Vince Styling</p>
            <p><i class="fa fa-envelope"></i>&emsp;lingyunxiao@qq.com</p>
            <p><i class="fa fa-rmb"></i>&emsp;I'm Chinese ;-)</p>
        </div>
        <div class="site-info">
            <p>Site hosted by <a href="https://pages.github.com/">Github Pages</a></p>
            <p>Generated by <a href="http://khaleesi.vincestyling.com/">Khaleesi</a></p>
            <p>Powered by <a href="https://www.ruby-lang.org/en/">Ruby</a></p>
        </div>
        <div style="clear:both"></div>
    </div>
</div>
</body>
</html>